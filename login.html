<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Login</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script>
        // ðŸ”‘ REPEAT your Firebase config keys here ðŸ”‘
        const firebaseConfig = {
            apiKey: "AIzaSyDommZvHGnuYW7iUkHFcc9zb8id-0PGrX8",
            authDomain: "hrac-2bcbb.firebaseapp.com",
            projectId: "hrac-2bcbb",
            storageBucket: "hrac-2bcbb.firebasestorage.app",
            messagingSenderId: "265024746847",
            appId: "1:265024746847:web:07f48991e018086ca772ea",
            measurementId: "G-K42TBV90PJ"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // 1. TEMPORARILY DISABLED: The onAuthStateChanged listener is commented out 
        // because it often conflicts with the signInWithRedirect flow.
        // We rely on the explicit redirects below for reliability.
        /*
        auth.onAuthStateChanged((user) => {
            if (user) {
                window.location.href = './index.html'; 
            }
        });
        */
        
        // 2. Function to initiate Google Sign-In
        function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            
            // Initiate the sign-in redirect
            auth.signInWithRedirect(provider)
                .catch((error) => {
                    console.error("Google Sign-In Failed:", error);
                    document.getElementById('authError').textContent = "Sign-in failed. Please try again.";
                });
        }

        // 3. ULTIMATE REDIRECT FIX: Check for the logged-in user immediately
        // This handles cases where the user is already signed in on the current page.
        if (auth.currentUser) {
            window.location.href = './index.html';
        }

        // 4. Handle the redirect response (the CRITICAL part for Google Sign-In)
        // Checks the result after Google sends the user back to this page.
        auth.getRedirectResult().then((result) => {
            // Check if a user was successfully authenticated via the redirect result
            if (result.user) {
                // User successfully logged in.
                // Explicitly redirect to the index page immediately.
                window.location.href = './index.html'; 
            }
        }).catch((error) => {
            // Handle errors after the redirect returns
            const errorMessage = error.message || "An unknown sign-in error occurred.";
            document.getElementById('authError').textContent = "Sign-in Failed: " + errorMessage;
            console.error(error);
        });
    </script>
    <style>
        /* Basic form styles */
        body { font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background-color: #f4f4f9; }
        .auth-container { background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); width: 300px; text-align: center; }
        .google-btn { 
            background-color: #4285f4; /* Google Blue */
            color: white; 
            padding: 10px 15px; 
            margin-top: 20px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-weight: bold;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        .google-icon { 
            margin-right: 10px;
            font-size: 1.2em; /* Increase icon size */
        }
        #authError { color: red; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="auth-container">
        <h2>Quiz Login</h2>
        
        <button class="google-btn" onclick="signInWithGoogle()">
            <span class="google-icon">G</span> 
            Sign In with Google
        </button>
        
        <p id="authError"></p>
        <a href="./index.html" style="margin-top: 20px; display: block; color: #6c757d;">&larr; Back to Home</a>
    </div>
</body>
</html>