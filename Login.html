<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Login Page</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .google-icon {
            /* Inline SVG for Google 'G' */
            width: 1.25rem;
            height: 1.25rem;
            fill: currentColor;
            margin-right: 0.5rem;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-md bg-white shadow-xl rounded-2xl p-8 transition-all duration-300 transform hover:shadow-2xl">
        <h1 class="text-3xl font-extrabold text-gray-900 mb-6 text-center">Webpage Login</h1>
        
        <!-- Status Card -->
        <div id="status-card" class="bg-indigo-50 border-l-4 border-indigo-500 text-indigo-800 p-4 rounded-lg mb-6 flex items-center justify-between shadow-sm" role="alert">
            <p id="auth-status" class="font-medium">Initializing application...</p>
        </div>

        <!-- Main Content Area (Shown after successful login) -->
        <div id="main-app" class="space-y-6 hidden">
            <h2 class="text-xl font-bold text-gray-800">Welcome! You are logged in.</h2>
            
            <!-- User Info Display -->
            <div class="bg-gray-100 p-4 rounded-lg shadow-inner space-y-2">
                <p class="text-sm font-semibold text-gray-600">Logged in as:</p>
                <p id="user-email-display" class="text-md font-medium text-gray-800 break-words">Loading...</p>
                
                <p class="text-sm font-semibold text-gray-600">Your Unique User ID:</p>
                <code id="user-id-display" class="block w-full text-xs break-all bg-white p-2 rounded-md border border-gray-300 text-gray-800">Loading...</code>
            </div>
            
            <!-- Sign Out Button -->
            <button id="sign-out-btn" onclick="signOutUser()" class="w-full px-6 py-3 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition-colors duration-200">
                Sign Out
            </button>
        </div>

        <!-- Sign In Options (Shown if not logged in) -->
        <div id="sign-in-options" class="space-y-4 hidden">
            <p class="text-center text-gray-500 font-medium">Choose your login method:</p>
            
            <!-- Google Sign-In Button -->
            <button id="google-sign-in-btn" onclick="signInWithGoogle()" class="w-full flex items-center justify-center px-6 py-3 bg-white border border-gray-300 text-gray-700 font-semibold rounded-lg shadow-md hover:bg-gray-50 transition-colors duration-200">
                <!-- Google G Icon SVG -->
                <svg class="google-icon" viewBox="0 0 48 48">
                    <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.23 9.21 3.29l5.47-5.47C36.67 4.71 30.55 2 24 2 13.4 2 4.9 8.2 1.5 17.3L12 24.4l1.24-.71c2.47-1.42 5.56-2.29 8.76-2.29s6.29.87 8.76 2.29l1.24.71L46.5 24.4c0-.71.01-1.4.01-2.1 0-7.85-6.17-14.8-14.5-14.8z"/>
                    <path fill="#4285F4" d="M46.5 24.4l-7.23-5.26c-2.5-1.92-5.75-3.04-9.27-3.04s-6.77 1.12-9.27 3.04L1.5 24.4c3.4 9.1 11.9 15.3 22.5 15.3 5.4 0 10.7-1.9 14.8-5.3L36 31.7l1.24-.71c2.47-1.42 5.56-2.29 8.76-2.29s6.29.87 8.76 2.29l1.24.71L46.5 24.4z"/>
                    <path fill="#FBBC05" d="M1.5 24.4L12 31.5l1.24-.71c2.47-1.42 5.56-2.29 8.76-2.29s6.29.87 8.76 2.29l1.24.71L46.5 24.4l-7.23-5.26c-2.5-1.92-5.75-3.04-9.27-3.04s-6.77 1.12-9.27 3.04L1.5 24.4z"/>
                    <path fill="#34A853" d="M12 31.5l1.24-.71c2.47-1.42 5.56-2.29 8.76-2.29s6.29.87 8.76 2.29l1.24.71L46.5 24.4l-7.23-5.26c-2.5-1.92-5.75-3.04-9.27-3.04s-6.77 1.12-9.27 3.04L1.5 24.4V40.2c3.4-9.1 11.9-15.3 22.5-15.3 5.4 0 10.7 1.9 14.8 5.3L36 31.7l1.24-.71c2.47-1.42 5.56-2.29 8.76-2.29s6.29.87 8.76 2.29l1.24.71z"/>
                </svg>
                Sign in with Google
            </button>

            <!-- Separator -->
            <div class="relative flex items-center">
                <div class="flex-grow border-t border-gray-300"></div>
                <span class="flex-shrink mx-4 text-gray-400 text-sm">OR</span>
                <div class="flex-grow border-t border-gray-300"></div>
            </div>

            <!-- Anonymous Sign-In Button -->
            <button id="anon-sign-in-btn" onclick="signInAnonymouslyUser()" class="w-full px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-200">
                Log In Anonymously
            </button>
        </div>
        
        <p id="error-message" class="text-center text-red-500 mt-4 hidden"></p>

    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        // --- User-Provided Configuration for Project hrac-game ---
        const userConfig = {
            apiKey: "AIzaSyB1yiiAMR3pPa6-Jzhjaq0k7CDPB3L_C44",
            authDomain: "hrac-game.firebaseapp.com",
            projectId: "hrac-game",
            storageBucket: "hrac-game.firebasestorage.app",
            messagingSenderId: "72236369603",
            appId: "1:72236369603:web:553ecd8299842073f3c476",
            measurementId: "G-GW7PZEKZJ7"
        };
        
        // Prioritize environment config if available, otherwise use user's hardcoded config.
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : userConfig;
        
        // --- Element References ---
        const statusElement = document.getElementById('auth-status');
        const userIdDisplay = document.getElementById('user-id-display');
        const userEmailDisplay = document.getElementById('user-email-display');
        const mainApp = document.getElementById('main-app');
        const signInOptions = document.getElementById('sign-in-options');
        const googleSignInBtn = document.getElementById('google-sign-in-btn');
        const anonSignInBtn = document.getElementById('anon-sign-in-btn');
        const errorMessage = document.getElementById('error-message');

        // --- Initialization ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const googleProvider = new GoogleAuthProvider();
        
        let currentUserId = null;

        /**
         * Attempts to sign the user in using Google pop-up.
         */
        window.signInWithGoogle = async function() {
            errorMessage.classList.add('hidden');
            googleSignInBtn.disabled = true;
            googleSignInBtn.textContent = 'Awaiting popup...';
            
            try {
                // signInWithPopup opens a new window for Google authentication
                await signInWithPopup(auth, googleProvider);
                // onAuthStateChanged listener handles UI update upon successful login
            } catch (error) {
                console.error("Google Sign-in Failed:", error);
                
                // User closed the popup, or another error occurred
                if (error.code !== 'auth/popup-closed-by-user') {
                    errorMessage.textContent = `Login Error: ${error.message}`;
                    errorMessage.classList.remove('hidden');
                } else {
                    errorMessage.textContent = `Sign-in attempt canceled.`;
                    errorMessage.classList.remove('hidden');
                    setTimeout(() => errorMessage.classList.add('hidden'), 3000);
                }
                
                googleSignInBtn.disabled = false;
                googleSignInBtn.innerHTML = `
                    <svg class="google-icon" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.23 9.21 3.29l5.47-5.47C36.67 4.71 30.55 2 24 2 13.4 2 4.9 8.2 1.5 17.3L12 24.4l1.24-.71c2.47-1.42 5.56-2.29 8.76-2.29s6.29.87 8.76 2.29l1.24.71L46.5 24.4c0-.71.01-1.4.01-2.1 0-7.85-6.17-14.8-14.5-14.8z"/><path fill="#4285F4" d="M46.5 24.4l-7.23-5.26c-2.5-1.92-5.75-3.04-9.27-3.04s-6.77 1.12-9.27 3.04L1.5 24.4c3.4 9.1 11.9 15.3 22.5 15.3 5.4 0 10.7-1.9 14.8-5.3L36 31.7l1.24-.71c2.47-1.42 5.56-2.29 8.76-2.29s6.29.87 8.76 2.29l1.24.71L46.5 24.4z"/><path fill="#FBBC05" d="M1.5 24.4L12 31.5l1.24-.71c2.47-1.42 5.56-2.29 8.76-2.29s6.29.87 8.76 2.29l1.24.71L46.5 24.4l-7.23-5.26c-2.5-1.92-5.75-3.04-9.27-3.04s-6.77 1.12-9.27 3.04L1.5 24.4z"/><path fill="#34A853" d="M12 31.5l1.24-.71c2.47-1.42 5.56-2.29 8.76-2.29s6.29.87 8.76 2.29l1.24.71L46.5 24.4l-7.23-5.26c-2.5-1.92-5.75-3.04-9.27-3.04s-6.77 1.12-9.27 3.04L1.5 24.4V40.2c3.4-9.1 11.9-15.3 22.5-15.3 5.4 0 10.7 1.9 14.8 5.3L36 31.7l1.24-.71c2.47-1.42 5.56-2.29 8.76-2.29s6.29.87 8.76 2.29l1.24.71z"/></svg>
                    Sign in with Google
                `;
            }
        }

        /**
         * Attempts to sign the user in anonymously.
         */
        window.signInAnonymouslyUser = async function() {
            errorMessage.classList.add('hidden');
            anonSignInBtn.disabled = true;
            anonSignInBtn.textContent = 'Logging in...';
            
            try {
                await signInAnonymously(auth);
            } catch (error) {
                console.error("Anonymous Sign-in Failed:", error);
                errorMessage.textContent = `Login Error: ${error.message}`;
                errorMessage.classList.remove('hidden');
                anonSignInBtn.disabled = false;
                anonSignInBtn.textContent = 'Log In Anonymously';
            }
        }
        
        /**
         * Signs the currently logged-in user out.
         */
        window.signOutUser = async function() {
            try {
                await signOut(auth);
            } catch (error) {
                console.error("Sign Out Error:", error);
                errorMessage.textContent = "Failed to sign out. Check console for details.";
                errorMessage.classList.remove('hidden');
                setTimeout(() => errorMessage.classList.add('hidden'), 3000);
            }
        }

        /**
         * Listens for authentication state changes and updates the UI.
         */
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in.
                currentUserId = user.uid;
                
                // Update Status Card to Success
                statusElement.textContent = `✅ Logged in as: ${user.email || 'Anonymous'}`;
                statusElement.parentElement.classList.replace('border-indigo-500', 'border-green-500');
                statusElement.parentElement.classList.replace('bg-indigo-50', 'bg-green-50');

                // Update UI
                userIdDisplay.textContent = currentUserId;
                userEmailDisplay.textContent = user.email || 'Anonymous User';
                mainApp.classList.remove('hidden');
                signInOptions.classList.add('hidden');
                
                // Reset buttons
                googleSignInBtn.disabled = false;
                googleSignInBtn.innerHTML = `
                    <svg class="google-icon" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.23 9.21 3.29l5.47-5.47C36.67 4.71 30.55 2 24 2 13.4 2 4.9 8.2 1.5 17.3L12 24.4l1.24-.71c2.47-1.42 5.56-2.29 8.76-2.29s6.29.87 8.76 2.29l1.24.71L46.5 24.4c0-.71.01-1.4.01-2.1 0-7.85-6.17-14.8-14.5-14.8z"/><path fill="#4285F4" d="M46.5 24.4l-7.23-5.26c-2.5-1.92-5.75-3.04-9.27-3.04s-6.77 1.12-9.27 3.04L1.5 24.4c3.4 9.1 11.9 15.3 22.5 15.3 5.4 0 10.7-1.9 14.8-5.3L36 31.7l1.24-.71c2.47-1.42 5.56-2.29 8.76-2.29s6.29.87 8.76 2.29l1.24.71L46.5 24.4z"/><path fill="#FBBC05" d="M1.5 24.4L12 31.5l1.24-.71c2.47-1.42 5.56-2.29 8.76-2.29s6.29.87 8.76 2.29l1.24.71L46.5 24.4l-7.23-5.26c-2.5-1.92-5.75-3.04-9.27-3.04s-6.77 1.12-9.27 3.04L1.5 24.4z"/><path fill="#34A853" d="M12 31.5l1.24-.71c2.47-1.42 5.56-2.29 8.76-2.29s6.29.87 8.76 2.29l1.24.71L46.5 24.4l-7.23-5.26c-2.5-1.92-5.75-3.04-9.27-3.04s-6.77 1.12-9.27 3.04L1.5 24.4V40.2c3.4-9.1 11.9-15.3 22.5-15.3 5.4 0 10.7 1.9 14.8 5.3L36 31.7l1.24-.71c2.47-1.42 5.56-2.29 8.76-2.29s6.29.87 8.76 2.29l1.24.71z"/></svg>
                    Sign in with Google
                `;
                anonSignInBtn.disabled = false;
                anonSignInBtn.textContent = 'Log In Anonymously';


            } else {
                // User is signed out.
                currentUserId = null;
                
                // Update Status Card to Prompt Login
                statusElement.textContent = "Not logged in. Choose a method below.";
                statusElement.parentElement.classList.replace('border-green-500', 'border-indigo-500');
                statusElement.parentElement.classList.replace('bg-green-50', 'bg-indigo-50');

                // Update UI
                mainApp.classList.add('hidden');
                signInOptions.classList.remove('hidden');
            }
        });
        
    </script>
</body>
</html>
